<style>
  #drag {
    display: inline-block;
    width: 100px;
    height: 100px;
    background-color: #000;
  }
</style>
<div id="container">
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡
  飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡 飘荡
</div>
<div id="drag"></div>

<script>
  const el = document.getElementById('drag');
  let recordx = 0, recordy = 0

  el.addEventListener('mousedown', e => {
    let x0 = e.clientX, y0 = e.clientY;

    function move (e) {
      let dx = e.clientX - x0 + recordx
      let dy = e.clientY - y0 + recordy
      // el.style.transform = `translate3d(${dx}px, ${dy}px, 0)`

      const range = getNearest(e.clientX,  e.clientY)
      range.insertNode(el)
    }

    function end (e) {
      recordx = e.clientX - x0 + recordx
      recordy = e.clientY - y0 + recordy

      document.removeEventListener('mousemove', move)
      document.removeEventListener('mouseup', end)
    }

    document.addEventListener('mousemove', move)
    document.addEventListener('mouseup', end)
    document.addEventListener('selectstart', e => e.preventDefault())
  })


  const container = document.getElementById('container')
  const ranges = []
  Array.prototype.map.call(container.childNodes[0].textContent, (text, i) => {
    const range = document.createRange()
    range.setStart(container.childNodes[0], i)
    range.setEnd(container.childNodes[0], i)
    console.log(range.getBoundingClientRect())
    ranges.push(range)
  })

  // 取距离最近的一个range
  function getNearest (x, y) {
    let minRange = null
    ranges.reduce((min, range) => {
      const rect = range.getBoundingClientRect()
      const d = distance(x - rect.x, y - rect.y)
      min > d && (minRange = range)
      return min > d ? d : min
    }, Infinity)

    return minRange
  }

  function distance (x, y) {
    return x ** 2 + y ** 2
  }
</script>
